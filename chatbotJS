/**
 * Enhanced Chatbot Script with Circular Floating Animation
 */
document.addEventListener('DOMContentLoaded', function() {
    console.log('Enhanced Chatbot script loaded');

    // Initialize the chatbot
    initChatbot();

    // Set up circular animation cycle
    setupCircularAnimationCycle();
});

/**
 * Set up a cycle of different circular animations for the chatbot button
 */
function setupCircularAnimationCycle() {
    const chatbotButton = document.getElementById('chatbotButton');
    if (!chatbotButton) return;

    // Basic circular float animation is applied via CSS

    // Every 45 seconds, switch to attention animation for 8 seconds
    setInterval(() => {
        chatbotButton.classList.remove('circular-pulse');
        chatbotButton.style.animation = 'none';

        // Trigger reflow
        void chatbotButton.offsetWidth;

        chatbotButton.classList.add('attention');

        setTimeout(() => {
            chatbotButton.classList.remove('attention');
            chatbotButton.style.animation = '';
        }, 8000);
    }, 45000);

    // Every 90 seconds, apply the pulse-circular animation for 10 seconds
    setInterval(() => {
        chatbotButton.classList.remove('attention');
        chatbotButton.style.animation = 'none';

        // Trigger reflow
        void chatbotButton.offsetWidth;

        chatbotButton.classList.add('circular-pulse');

        setTimeout(() => {
            chatbotButton.classList.remove('circular-pulse');
            chatbotButton.style.animation = '';
        }, 10000);
    }, 90000);
}

/**
 * Initialize the chatbot functionality
 */
function initChatbot() {
    // Get the chat button
    const chatbotButton = document.getElementById('chatbotButton');

    if (!chatbotButton) {
        console.error('Chatbot button not found!');
        return;
    }

    console.log('Chatbot button found, initializing...');

    // Create the chat interface
    createChatInterface();

    // Add event listener to the button
    chatbotButton.addEventListener('click', toggleChat);
}

/**
 * Create the chatbot interface
 */
function createChatInterface() {
    // Check if it already exists
    if (document.getElementById('chatbot-popup')) {
        return;
    }

    // Create the chat container
    const chatPopup = document.createElement('div');
    chatPopup.id = 'chatbot-popup';

    // Create the bot avatar image source
    const botAvatarSrc = 'https://ui-avatars.com/api/?name=ESPRIT&background=E12D2D&color=fff&size=128';
    const userAvatarSrc = 'https://ui-avatars.com/api/?name=Mohamed&background=2D3748&color=fff&size=128';

    // Default to offline mode
    window.isOnlineMode = false;

    // Set the content
    chatPopup.innerHTML = `
        <div class="chat-header">
            <div class="chat-header-title">
                <i class="fas fa-robot"></i>
                ESPRIT Assistant
            </div>
            <div class="chat-mode-toggle">
                <span class="mode-label offline-label">Offline</span>
                <label class="switch">
                    <input type="checkbox" id="mode-toggle">
                    <span class="slider round"></span>
                </label>
                <span class="mode-label online-label">Online</span>
            </div>
            <div class="chat-actions">
                <button class="chat-action-btn" id="chat-minimize" aria-label="Minimiser">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="chat-action-btn chat-close" id="chat-close" aria-label="Fermer">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <div class="chat-messages" id="chat-messages">
            <div class="welcome-message">
                <h4>Bienvenue sur ESPRIT CV Generator</h4>
                <p>Je suis votre assistant virtuel. Comment puis-je vous aider aujourd'hui?</p>
                <div class="mode-info">
                    <span class="mode-info-icon"><i class="fas fa-info-circle"></i></span>
                    <span class="mode-info-text">Le mode hors ligne est activÃ©. Les rÃ©ponses sont prÃ©dÃ©finies.</span>
                </div>
            </div>
            
            <div class="message bot animate-in">
                <div class="message-avatar">
                    <img src="${botAvatarSrc}" alt="Bot Avatar">
                </div>
                <div class="message-container">
                    <div class="message-header">
                        <span class="message-sender">ESPRIT Assistant</span>
                        <span class="message-time">${formatTime(new Date())}</span>
                    </div>
                    <p class="message-content">Bonjour! Je suis votre assistant ESPRIT CV Generator. Comment puis-je vous aider aujourd'hui?</p>
                    <div class="message-footer">
                        <span>EnvoyÃ©</span>
                    </div>
                </div>
                <div class="message-actions">
                    <button class="message-action-btn" aria-label="Options" data-message-id="bot-1">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <div class="message-action-dropdown" id="dropdown-bot-1">
                        <ul>
                            <li><a href="#" class="copy-message"><i class="far fa-copy"></i> Copier</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chat-input-container">
            <div class="chat-input-actions">
                <button class="chat-input-action" id="chat-emoji" aria-label="Ajouter emoji">
                    <i class="far fa-smile"></i>
                </button>
                <button class="chat-input-action" id="chat-attachment" aria-label="Joindre un fichier">
                    <i class="fas fa-paperclip"></i>
                </button>
            </div>
            <input type="text" id="chat-input" placeholder="Ã‰crivez votre message..." aria-label="Ã‰crivez votre message...">
            <button id="chat-send" aria-label="Envoyer">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    `;

    // Add to body
    document.body.appendChild(chatPopup);

    // Create external suggestions container
    const suggestionsContainer = document.createElement('div');
    suggestionsContainer.className = 'suggestions-container';
    suggestionsContainer.id = 'suggestions-container';
    suggestionsContainer.innerHTML = `
        <div class="suggestion-title">Suggestions</div>
        <button class="suggestion-button" data-message="Comment crÃ©er un CV?" data-lang="fr">
            <i class="fas fa-file-alt"></i> Comment crÃ©er un CV?
        </button>
        <button class="suggestion-button" data-message="ÙƒÙŠÙØ§Ø´ Ù†Ù„Ù‚Ù‰ Ø®Ø¯Ù…Ø©ØŸ" data-lang="ar">
            <i class="fas fa-briefcase"></i> ÙƒÙŠÙØ§Ø´ Ù†Ù„Ù‚Ù‰ Ø®Ø¯Ù…Ø©ØŸ
        </button>
        <button class="suggestion-button" data-message="Templates disponibles?" data-lang="fr">
            <i class="fas fa-palette"></i> Templates disponibles?
        </button>
        <button class="suggestion-button" data-message="Ø´Ù†ÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ" data-lang="ar">
            <i class="fas fa-star"></i> Ø´Ù†ÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ
        </button>
    `;

    document.body.appendChild(suggestionsContainer);

    // Add event listeners
    document.getElementById('chat-close').addEventListener('click', () => toggleChat(false));
    document.getElementById('chat-minimize').addEventListener('click', () => toggleChat(false));
    document.getElementById('chat-send').addEventListener('click', sendMessage);
    document.getElementById('chat-attachment').addEventListener('click', showAttachmentOptions);
    document.getElementById('chat-emoji').addEventListener('click', showEmojiPicker);

    // Add event listener for the online/offline mode toggle
    const modeToggle = document.getElementById('mode-toggle');
    if (modeToggle) {
        modeToggle.addEventListener('change', function() {
            toggleOnlineMode(this.checked);
        });
    }

    const chatInput = document.getElementById('chat-input');
    if (chatInput) {
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    }

    // Add suggestion button functionality
    const suggestionButtons = document.querySelectorAll('.suggestion-button');
    suggestionButtons.forEach(button => {
        button.addEventListener('click', function() {
            const message = this.getAttribute('data-message');
            const lang = this.getAttribute('data-lang');
            if (message) {
                // Set the message in the input
                const chatInput = document.getElementById('chat-input');
                if (chatInput) {
                    chatInput.value = message;

                    // Set the preferred language based on the suggestion
                    if (lang) {
                        window.preferredLanguage = lang;
                    }

                    sendMessage();
                }
            }
        });
    });

    // Setup message action dropdowns
    setupMessageActions();
}

/**
 * Toggle between online and offline mode
 * @param {boolean} isOnline - Whether to enable online mode
 */
function toggleOnlineMode(isOnline) {
    window.isOnlineMode = isOnline;

    // Update UI to reflect mode change
    const chatMessages = document.getElementById('chat-messages');
    const modeInfo = chatMessages.querySelector('.mode-info-text');

    if (modeInfo) {
        modeInfo.classList.add('animate-fade-out');

        setTimeout(() => {
            if (isOnline) {
                modeInfo.innerHTML = 'Le mode en ligne est activÃ©. RÃ©ponses du modÃ¨le en temps rÃ©el.';
                modeInfo.style.color = '#4CAF50';
            } else {
                modeInfo.innerHTML = 'Le mode hors ligne est activÃ©. Les rÃ©ponses sont prÃ©dÃ©finies.';
                modeInfo.style.color = '';
            }
            modeInfo.classList.remove('animate-fade-out');
            modeInfo.classList.add('animate-fade-in');

            setTimeout(() => {
                modeInfo.classList.remove('animate-fade-in');
            }, 300);
        }, 300);
    }

    // Add status message to chat
    const statusMessage = document.createElement('div');
    statusMessage.className = 'chat-status-message animate-fade-in';

    if (isOnline) {
        statusMessage.innerHTML = `
            <div class="status-icon online">
                <i class="fas fa-plug"></i>
            </div>
            <div class="status-text">
                Mode en ligne activÃ©. Assistant connectÃ© Ã  l'API.
            </div>
        `;
    } else {
        statusMessage.innerHTML = `
            <div class="status-icon offline">
                <i class="fas fa-power-off"></i>
            </div>
            <div class="status-text">
                Mode hors ligne activÃ©. Utilisation des rÃ©ponses locales.
            </div>
        `;
    }

    chatMessages.appendChild(statusMessage);
    scrollToBottom();

    // Remove status message after a few seconds
    setTimeout(() => {
        statusMessage.classList.add('animate-fade-out');
        setTimeout(() => {
            if (statusMessage.parentNode) {
                statusMessage.parentNode.removeChild(statusMessage);
            }
        }, 300);
    }, 3000);
}

/**
 * Show attachment options dialog
 */
function showAttachmentOptions() {
    const chatMessages = document.getElementById('chat-messages');
    if (!chatMessages) return;

    // Create attachment options container if it doesn't exist
    let attachmentOptions = document.getElementById('attachment-options');
    if (attachmentOptions) {
        attachmentOptions.remove();
    }

    attachmentOptions = document.createElement('div');
    attachmentOptions.id = 'attachment-options';
    attachmentOptions.className = 'attachment-options animate-pop';

    attachmentOptions.innerHTML = `
        <div class="attachment-header">Joindre un fichier</div>
        <div class="attachment-types">
            <button class="attachment-type" data-type="cv">
                <i class="fas fa-file-pdf"></i>
                <span>CV existant</span>
            </button>
            <button class="attachment-type" data-type="image">
                <i class="fas fa-image"></i>
                <span>Photo</span>
            </button>
            <button class="attachment-type" data-type="document">
                <i class="fas fa-file-alt"></i>
                <span>Document</span>
            </button>
        </div>
        <div class="attachment-footer">
            <button id="cancel-attachment">Annuler</button>
        </div>
    `;

    chatMessages.appendChild(attachmentOptions);

    // Add event listeners
    document.querySelectorAll('.attachment-type').forEach(button => {
        button.addEventListener('click', function() {
            const type = this.getAttribute('data-type');
            simulateFileUpload(type);
            attachmentOptions.remove();
        });
    });

    document.getElementById('cancel-attachment').addEventListener('click', function() {
        attachmentOptions.classList.add('animate-out');
        setTimeout(() => {
            if (attachmentOptions.parentNode) {
                attachmentOptions.parentNode.removeChild(attachmentOptions);
            }
        }, 300);
    });
}

/**
 * Simulates file upload process
 * @param {string} type - Type of file to upload
 */
function simulateFileUpload(type) {
    const chatMessages = document.getElementById('chat-messages');
    if (!chatMessages) return;

    // Create upload status message
    const uploadStatus = document.createElement('div');
    uploadStatus.className = 'upload-status animate-slide-in';
    uploadStatus.innerHTML = `
        <div class="upload-icon"><i class="fas fa-file-upload"></i></div>
        <div class="upload-details">
            <div class="upload-filename">fichier_${type}.${type === 'cv' ? 'pdf' : (type === 'image' ? 'jpg' : 'doc')}</div>
            <div class="upload-progress-container">
                <div class="upload-progress-bar" style="width: 0%"></div>
            </div>
            <div class="upload-percentage">0%</div>
        </div>
        <div class="upload-actions">
            <button class="upload-cancel"><i class="fas fa-times"></i></button>
        </div>
    `;

    chatMessages.appendChild(uploadStatus);
    scrollToBottom();

    // Simulate progress
    let progress = 0;
    const progressBar = uploadStatus.querySelector('.upload-progress-bar');
    const progressPercentage = uploadStatus.querySelector('.upload-percentage');

    const progressInterval = setInterval(() => {
        progress += 5;
        progressBar.style.width = `${progress}%`;
        progressPercentage.textContent = `${progress}%`;

        if (progress >= 100) {
            clearInterval(progressInterval);

            // Replace with success message
            setTimeout(() => {
                uploadStatus.innerHTML = `
                    <div class="upload-complete animate-bounce">
                        <i class="fas fa-check-circle"></i>
                        <span>Fichier tÃ©lÃ©chargÃ© avec succÃ¨s</span>
                    </div>
                `;

                // Add bot response about the file
                setTimeout(() => {
                    const botMessageId = 'bot-' + Date.now();
                    let responseMessage = '';

                    switch(type) {
                        case 'cv':
                            responseMessage = window.preferredLanguage === 'ar' ?
                                'Ø´ÙƒØ±Ø§ Ø¹Ù„Ù‰ Ù…Ø´Ø§Ø±ÙƒØ© Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ©. Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ ØªØ­Ù„ÙŠÙ„Ù‡Ø§ Ø£Ùˆ ØªØ­Ø³ÙŠÙ†Ù‡Ø§ØŸ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ±Ù‡Ø§.' :
                                'Merci d\'avoir partagÃ© votre CV. Souhaitez-vous que je l\'analyse ou que je vous aide Ã  l\'amÃ©liorer? Je peux vous aider Ã  identifier les points Ã  dÃ©velopper.';
                            break;
                        case 'image':
                            responseMessage = window.preferredLanguage === 'ar' ?
                                'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¥Ù„Ù‰ Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ© ÙƒØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©ØŸ' :
                                'L\'image a Ã©tÃ© reÃ§ue avec succÃ¨s. Voulez-vous l\'ajouter Ã  votre CV comme photo de profil?';
                            break;
                        case 'document':
                            responseMessage = window.preferredLanguage === 'ar' ?
                                'Ø´ÙƒØ±Ø§ Ø¹Ù„Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯. Ù‡Ù„ Ù‡Ø°Ø§ Ù…Ø³ØªÙ†Ø¯ Ø¯Ø§Ø¹Ù… Ù„Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ© Ù…Ø«Ù„ Ø±Ø³Ø§Ù„Ø© ØªÙˆØµÙŠØ© Ø£Ùˆ Ø´Ù‡Ø§Ø¯Ø©ØŸ' :
                                'Merci pour ce document. S\'agit-il d\'un document complÃ©mentaire Ã  votre CV comme une lettre de recommandation ou un certificat?';
                            break;
                    }

                    addBotMessage(responseMessage, botMessageId);

                    // Update suggestions based on uploaded file type
                    let newSuggestions = [];
                    if (type === 'cv') {
                        newSuggestions = window.preferredLanguage === 'ar' ? [
                            { icon: 'fas fa-search', text: 'Ø­Ù„Ù„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©', lang: 'ar' },
                            { icon: 'fas fa-edit', text: 'Ø§Ù‚ØªØ±Ø­ ØªØ­Ø³ÙŠÙ†Ø§Øª', lang: 'ar' },
                            { icon: 'fas fa-redo', text: 'Ù‚Ø§Ø±Ù† Ù…Ø¹ Ù†Ù…ÙˆØ°Ø¬ Ø­Ø¯ÙŠØ«', lang: 'ar' },
                            { icon: 'fas fa-check', text: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', lang: 'ar' }
                        ] : [
                            { icon: 'fas fa-search', text: 'Analyser le CV', lang: 'fr' },
                            { icon: 'fas fa-edit', text: 'Suggestions d\'amÃ©lioration', lang: 'fr' },
                            { icon: 'fas fa-redo', text: 'Comparer avec un modÃ¨le moderne', lang: 'fr' },
                            { icon: 'fas fa-check', text: 'VÃ©rifier les informations', lang: 'fr' }
                        ];
                    } else if (type === 'image') {
                        newSuggestions = window.preferredLanguage === 'ar' ? [
                            { icon: 'fas fa-user-circle', text: 'Ø§Ø³ØªØ®Ø¯Ù… ÙƒØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©', lang: 'ar' },
                            { icon: 'fas fa-crop', text: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©', lang: 'ar' },
                            { icon: 'fas fa-times', text: 'Ù„Ø§ Ø£Ø±ÙŠØ¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØ±Ø©', lang: 'ar' },
                            { icon: 'fas fa-question-circle', text: 'Ù†ØµØ§Ø¦Ø­ Ø­ÙˆÙ„ ØµÙˆØ± Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©', lang: 'ar' }
                        ] : [
                            { icon: 'fas fa-user-circle', text: 'Utiliser comme photo de profil', lang: 'fr' },
                            { icon: 'fas fa-crop', text: 'Ã‰diter l\'image', lang: 'fr' },
                            { icon: 'fas fa-times', text: 'Ne pas utiliser l\'image', lang: 'fr' },
                            { icon: 'fas fa-question-circle', text: 'Conseils sur les photos de CV', lang: 'fr' }
                        ];
                    } else {
                        newSuggestions = window.preferredLanguage === 'ar' ? [
                            { icon: 'fas fa-paperclip', text: 'Ø£Ø±ÙÙ‚ Ø¨Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©', lang: 'ar' },
                            { icon: 'fas fa-eye', text: 'Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªÙ†Ø¯', lang: 'ar' },
                            { icon: 'fas fa-times', text: 'Ø¥Ù„ØºØ§Ø¡', lang: 'ar' },
                            { icon: 'fas fa-info-circle', text: 'Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¯Ø§Ø¹Ù…Ø© Ø£Ø®Ø±Ù‰ØŸ', lang: 'ar' }
                        ] : [
                            { icon: 'fas fa-paperclip', text: 'Joindre au CV', lang: 'fr' },
                            { icon: 'fas fa-eye', text: 'Afficher le document', lang: 'fr' },
                            { icon: 'fas fa-times', text: 'Annuler', lang: 'fr' },
                            { icon: 'fas fa-info-circle', text: 'Autres documents utiles?', lang: 'fr' }
                        ];
                    }

                    updateSuggestionButtons(document.getElementById('suggestions-container'), newSuggestions);
                    if (document.getElementById('suggestions-container-mobile')) {
                        updateSuggestionButtons(document.getElementById('suggestions-container-mobile'), newSuggestions);
                    }
                }, 500);
            }, 1000);
        }
    }, 100);

    // Add cancel upload functionality
    const cancelButton = uploadStatus.querySelector('.upload-cancel');
    cancelButton.addEventListener('click', () => {
        clearInterval(progressInterval);
        uploadStatus.classList.add('animate-slide-out');
        setTimeout(() => {
            if (uploadStatus.parentNode) {
                uploadStatus.parentNode.removeChild(uploadStatus);
            }
        }, 300);
    });
}

/**
 * Show emoji picker dialog
 */
function showEmojiPicker() {
    const chatInput = document.getElementById('chat-input');
    if (!chatInput) return;

    // Create emoji picker if it doesn't exist
    let emojiPicker = document.getElementById('emoji-picker');
    if (emojiPicker) {
        emojiPicker.remove();
    }

    emojiPicker = document.createElement('div');
    emojiPicker.id = 'emoji-picker';
    emojiPicker.className = 'emoji-picker animate-scale-in';

    // Common emojis for CV & job search context
    const emojis = [
        'ğŸ‘', 'ğŸ‘‹', 'ğŸ˜Š', 'ğŸ™‚', 'ğŸ‘¨â€ğŸ’¼', 'ğŸ‘©â€ğŸ’¼',
        'ğŸ“„', 'ğŸ“', 'ğŸ“Š', 'ğŸ’¼', 'ğŸ“', 'ğŸ†',
        'ğŸ“Œ', 'âœ…', 'â“', 'ğŸ“±', 'ğŸ’»', 'ğŸ“¨',
        'ğŸ”', 'â³', 'ğŸ‘', 'ğŸŒŸ', 'ğŸš€', 'ğŸ‘¨â€ğŸ“'
    ];

    let emojiHtml = '<div class="emoji-container">';
    emojis.forEach(emoji => {
        emojiHtml += `<span class="emoji">${emoji}</span>`;
    });
    emojiHtml += '</div>';
    emojiHtml += '<button id="close-emoji-picker">Fermer</button>';

    emojiPicker.innerHTML = emojiHtml;

    // Position the emoji picker
    const chatInputContainer = document.querySelector('.chat-input-container');
    chatInputContainer.appendChild(emojiPicker);

    // Add event listeners to emojis
    document.querySelectorAll('.emoji').forEach(emojiElement => {
        emojiElement.addEventListener('click', function() {
            chatInput.value += this.textContent;
            chatInput.focus();
        });
    });

    document.getElementById('close-emoji-picker').addEventListener('click', function() {
        emojiPicker.classList.add('animate-scale-out');
        setTimeout(() => {
            if (emojiPicker.parentNode) {
                emojiPicker.parentNode.removeChild(emojiPicker);
            }
        }, 300);
    });
}

/**
 * Setup message action buttons and dropdowns
 */
function setupMessageActions() {
    document.addEventListener('click', function(e) {
        // Check if clicked element is a message action button
        if (e.target.closest('.message-action-btn')) {
            const btn = e.target.closest('.message-action-btn');
            const messageId = btn.getAttribute('data-message-id');
            const dropdown = document.getElementById(`dropdown-${messageId}`);

            if (dropdown) {
                // Toggle dropdown
                dropdown.classList.toggle('active');
                e.stopPropagation();
            }
        } else {
            // Close all dropdowns when clicking elsewhere
            const dropdowns = document.querySelectorAll('.message-action-dropdown');
            dropdowns.forEach(dropdown => dropdown.classList.remove('active'));
        }

        // Handle copy message action
        if (e.target.closest('.copy-message')) {
            e.preventDefault();
            const messageElement = e.target.closest('.message');
            if (messageElement) {
                const messageText = messageElement.querySelector('.message-content').textContent;
                navigator.clipboard.writeText(messageText).then(() => {
                    console.log('Message copied to clipboard');
                    showToast('Message copiÃ©!');
                });
            }
        }

        // Handle delete message action
        if (e.target.closest('.delete-message')) {
            e.preventDefault();
            const messageElement = e.target.closest('.message');
            if (messageElement) {
                // Add fade-out animation
                messageElement.classList.add('animate-fade-out');

                // Remove element after animation completes
                setTimeout(() => {
                    if (messageElement.parentNode) {
                        messageElement.parentNode.removeChild(messageElement);
                    }
                    showToast('Message supprimÃ©');
                }, 300);
            }
        }
    });
}

/**
 * Toggle the chat interface visibility
 * @param {boolean|undefined} show - True to show, false to hide, undefined to toggle
 */
function toggleChat(show) {
    const chatPopup = document.getElementById('chatbot-popup');
    const suggestionsContainer = document.getElementById('suggestions-container');

    if (!chatPopup) {
        console.error('Chat popup not found');
        return;
    }

    // If show is explicitly defined, set that state
    if (show === true) {
        chatPopup.classList.add('active');
        chatPopup.classList.add('animate-slide-in-up');

        setTimeout(() => {
            chatPopup.classList.remove('animate-slide-in-up');
        }, 500);

        if (suggestionsContainer) {
            suggestionsContainer.classList.add('active');
            suggestionsContainer.classList.add('animate-fade-in');

            setTimeout(() => {
                suggestionsContainer.classList.remove('animate-fade-in');
            }, 500);
        }

        setTimeout(() => {
            const inputField = document.getElementById('chat-input');
            if (inputField) inputField.focus();
        }, 300);
    } else if (show === false) {
        chatPopup.classList.add('animate-slide-out-down');

        if (suggestionsContainer) {
            suggestionsContainer.classList.add('animate-fade-out');
        }

        setTimeout(() => {
            chatPopup.classList.remove('active');
            chatPopup.classList.remove('animate-slide-out-down');

            if (suggestionsContainer) {
                suggestionsContainer.classList.remove('active');
                suggestionsContainer.classList.remove('animate-fade-out');
            }
        }, 300);
    } else {
        // Toggle state
        if (chatPopup.classList.contains('active')) {
            // Hide with animation
            chatPopup.classList.add('animate-slide-out-down');

            if (suggestionsContainer) {
                suggestionsContainer.classList.add('animate-fade-out');
            }

            setTimeout(() => {
                chatPopup.classList.remove('active');
                chatPopup.classList.remove('animate-slide-out-down');

                if (suggestionsContainer) {
                    suggestionsContainer.classList.remove('active');
                    suggestionsContainer.classList.remove('animate-fade-out');
                }
            }, 300);
        } else {
            // Show with animation
            chatPopup.classList.add('active');
            chatPopup.classList.add('animate-slide-in-up');

            setTimeout(() => {
                chatPopup.classList.remove('animate-slide-in-up');
            }, 500);

            if (suggestionsContainer) {
                suggestionsContainer.classList.add('active');
                suggestionsContainer.classList.add('animate-fade-in');

                setTimeout(() => {
                    suggestionsContainer.classList.remove('animate-fade-in');
                }, 500);
            }

            setTimeout(() => {
                const inputField = document.getElementById('chat-input');
                if (inputField) inputField.focus();
            }, 300);
        }
    }

    // Check if we need to adjust suggestions container position for mobile
    adjustSuggestionsPosition();
}

/**
 * Adjust the position of suggestions container based on screen size
 */
function adjustSuggestionsPosition() {
    const suggestionsContainer = document.getElementById('suggestions-container');
    const chatMessages = document.getElementById('chat-messages');

    if (!suggestionsContainer || !chatMessages) return;

    // Check window width for mobile view
    if (window.innerWidth <= 768) {
        // Move suggestions inside the chat messages container for mobile
        if (!document.querySelector('.chat-messages .suggestions-container')) {
            const suggestionsClone = suggestionsContainer.cloneNode(true);
            suggestionsClone.id = 'suggestions-container-mobile';
            chatMessages.appendChild(suggestionsClone);
            suggestionsContainer.style.display = 'none';

            // Add event listeners to the cloned suggestion buttons
            const suggestionButtons = suggestionsClone.querySelectorAll('.suggestion-button');
            suggestionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const message = this.getAttribute('data-message');
                    const lang = this.getAttribute('data-lang');
                    if (message) {
                        const chatInput = document.getElementById('chat-input');
                        if (chatInput) {
                            chatInput.value = message;

                            // Set the preferred language based on the suggestion
                            if (lang) {
                                window.preferredLanguage = lang;
                            }

                            sendMessage();
                        }
                    }
                });
            });
        }
    } else {
        // Remove suggestions from inside chat on desktop
        const mobileSuggestions = document.getElementById('suggestions-container-mobile');
        if (mobileSuggestions) {
            mobileSuggestions.remove();
        }
        suggestionsContainer.style.display = '';
    }
}

/**
 * Send a message from the user
 */
function sendMessage() {
    const chatInput = document.getElementById('chat-input');
    const chatMessages = document.getElementById('chat-messages');

    if (!chatInput || !chatMessages) {
        console.error('Chat input or messages container not found');
        return;
    }

    const message = chatInput.value.trim();

    if (message === '') return;

    // Clear the input
    chatInput.value = '';

    // Generate a unique message ID
    const userMessageId = 'user-' + Date.now();

    // Determine language of message for later response matching
    const containsArabic = /[\u0600-\u06FF]/.test(message);
    const messageLanguage = containsArabic ? 'ar' : 'fr';

    // Store language with message for later reference
    const messageData = {
        text: message,
        language: messageLanguage
    };

    // Add user message
    addUserMessage(message, userMessageId, messageData);

    // Show typing indicator with animation
    showTypingIndicator();

    // Different behavior based on online/offline mode
    if (window.isOnlineMode) {
        // Simulate API call delay - In a real app, you'd call your API here
        setTimeout(() => {
            // Hide typing indicator
            hideTypingIndicator();

            // Here you would normally process the API response
            // For now we'll simulate it with a placeholder response
            const botResponse = getOnlineModeResponse(message, messageData.language);

            // Add bot response with animation
            const botMessageId = 'bot-' + Date.now();
            addBotMessage(botResponse, botMessageId);

            // Update suggestions based on the conversation
            updateSuggestions(message, messageData.language);

            // Mark message as read with animation
            setTimeout(() => {
                const userMessageElement = document.querySelector(`[data-message-id="${userMessageId}"]`);
                if (userMessageElement) {
                    const messageElement = userMessageElement.closest('.message');
                    if (messageElement) {
                        const statusElement = messageElement.querySelector('.message-footer span');
                        if (statusElement) {
                            statusElement.classList.add('status-change');
                            statusElement.textContent = messageData.language === 'ar' ? 'Ù…Ù‚Ø±ÙˆØ¡Ø©' : 'Lu';

                            setTimeout(() => {
                                statusElement.classList.remove('status-change');
                            }, 300);
                        }
                    }
                }
            }, 1000);
        }, 2000 + Math.random() * 2000); // Longer delay for online mode to simulate API call
    } else {
        // Offline mode - use predefined responses
        setTimeout(() => {
            // Hide typing indicator
            hideTypingIndicator();

            // Generate bot response from local data
            const botResponse = getBotResponse(message, messageData.language);

            // Add bot response with animation
            const botMessageId = 'bot-' + Date.now();
            addBotMessage(botResponse, botMessageId);

            // Update suggestions based on the conversation
            updateSuggestions(message, messageData.language);

            // Mark message as read with animation
            setTimeout(() => {
                const userMessageElement = document.querySelector(`[data-message-id="${userMessageId}"]`);
                if (userMessageElement) {
                    const messageElement = userMessageElement.closest('.message');
                    if (messageElement) {
                        const statusElement = messageElement.querySelector('.message-footer span');
                        if (statusElement) {
                            statusElement.classList.add('status-change');
                            statusElement.textContent = messageData.language === 'ar' ? 'Ù…Ù‚Ø±ÙˆØ¡Ø©' : 'Lu';

                            setTimeout(() => {
                                statusElement.classList.remove('status-change');
                            }, 300);
                        }
                    }
                }
            }, 1000);
        }, 1000 + Math.random() * 1500); // Shorter delay for offline mode
    }
}

/**
 * Get a response from the "online" simulated AI model
 * In a real app, this would call an API rather than use predetermined responses
 * @param {string} message - The user's message
 * @param {string} language - The language of the message
 * @returns {string} - The bot's response
 */
function getOnlineModeResponse(message, language) {
    // In a real app, this would make an API call to a language model service
    // For now, we'll simulate with a slightly more dynamic response than the offline mode

    message = message.toLowerCase();

    // Initialize response with default message
    let response = '';
    let currentDate = new Date();
    let currentDateString = `${currentDate.getDate()}/${currentDate.getMonth() + 1}/${currentDate.getFullYear()}`;
    let currentTimeString = `${currentDate.getHours()}:${currentDate.getMinutes()}`;

    if (language === 'fr') {
        // Add AI-like greeting and context
        response = `[Mode AI - ${currentDateString} ${currentTimeString}]\n\n`;

        // Add personalized response
        if (message.includes('bonjour') || message.includes('salut') || message.includes('hello')) {
            response += `Bonjour ! Je suis ravi de vous aider aujourd'hui. Je suis votre assistant ESPRIT CV Generator connectÃ© Ã  notre API d'intelligence artificielle. Comment puis-je vous aider avec votre CV ou votre recherche d'emploi ?`;
        }
        // Check for CV creation questions
        else if ((message.includes('cv') || message.includes('curriculum') || message.includes('resume')) &&
            (message.includes('creer') || message.includes('crÃ©er') || message.includes('faire'))) {
            response += `Pour crÃ©er un CV professionnel, je vous invite Ã  cliquer sur le bouton "CrÃ©er mon CV" en haut de la page. Notre systÃ¨me vous guidera Ã  travers plusieurs Ã©tapes :\n\n1. SÃ©lection d'un template adaptÃ© Ã  votre secteur d'activitÃ©\n2. Saisie de vos informations personnelles et de contact\n3. Description de votre expÃ©rience professionnelle\n4. Ajout de votre formation et qualifications\n5. Personnalisation du design et des couleurs\n\nSouhaitez-vous des conseils spÃ©cifiques pour une section particuliÃ¨re du CV ?`;
        }
        else {
            // Default to the offline response but with a different prefix
            response += getBotResponse(message, language);
        }
    } else {
        // Arabic mode
        response = `[ÙˆØ¶Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - ${currentDateString} ${currentTimeString}]\n\n`;

        if (message.includes('Ø¹Ø³Ù„Ø§Ù…Ø©') || message.includes('Ø³Ù„Ø§Ù…') || message.includes('Ù…Ø±Ø­Ø¨Ø§')) {
            response += `Ø¹Ø³Ù„Ø§Ù…Ø©! ÙŠØ³Ø¹Ø¯Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…. Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ ESPRIT CV Generator Ù…ØªØµÙ„ Ø¨ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ø¯ÙŠÙ†Ø§. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ© Ø£Ùˆ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙˆØ¸ÙŠÙØ©ØŸ`;
        }
        // Check for CV creation questions in Arabic
        else if ((message.includes('cv') || message.includes('Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©')) &&
            (message.includes('Ù†Ø¹Ù…Ù„') || message.includes('Ù†Ø®Ø¯Ù…'))) {
            response += `Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ©ØŒ Ø£Ø¯Ø¹ÙˆÙƒ Ù„Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "CrÃ©er mon CV" Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©. Ø³ÙŠØ±Ø´Ø¯Ùƒ Ù†Ø¸Ø§Ù…Ù†Ø§ Ù…Ù† Ø®Ù„Ø§Ù„ Ø¹Ø¯Ø© Ø®Ø·ÙˆØ§Øª:\n\n1. Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø§Ù„Ø¨ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù…Ø¬Ø§Ù„ Ø¹Ù…Ù„Ùƒ\n2. Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§ØªØµØ§Ù„\n3. ÙˆØµÙ Ø®Ø¨Ø±ØªÙƒ Ø§Ù„Ù…Ù‡Ù†ÙŠØ©\n4. Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ…Ùƒ ÙˆÙ…Ø¤Ù‡Ù„Ø§ØªÙƒ\n5. ØªØ®ØµÙŠØµ Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†\n\nÙ‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØµØ§Ø¦Ø­ Ù…Ø­Ø¯Ø¯Ø© Ù„Ù‚Ø³Ù… Ù…Ø¹ÙŠÙ† Ù…Ù† Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©ØŸ`;
        }
        else {
            // Default to the offline response with a different prefix
            response += getBotResponse(message, language);
        }
    }

    return response;
}

/**
 * Add a user message to the chat
 * @param {string} message - The message text
 * @param {string} messageId - Unique ID for the message
 * @param {object} messageData - Additional data about the message
 */
function addUserMessage(message, messageId, messageData = {}) {
    const chatMessages = document.getElementById('chat-messages');

    if (!chatMessages) return;

    const userAvatarSrc = 'https://ui-avatars.com/api/?name=Mohamed&background=2D3748&color=fff&size=128';
    const language = messageData.language || 'fr';

    const messageElement = document.createElement('div');
    messageElement.className = 'message user animate-message-in-right';
    messageElement.setAttribute('data-language', language);
    messageElement.setAttribute('data-message-id', messageId);

    messageElement.innerHTML = `
        <div class="message-avatar">
            <img src="${userAvatarSrc}" alt="Your Avatar">
        </div>
        <div class="message-container ${language === 'ar' ? 'rtl-text' : ''}">
            <div class="message-header">
                <span class="message-sender">${language === 'ar' ? 'Ø£Ù†Øª' : 'Vous'}</span>
                <span class="message-time">${formatTime(new Date())}</span>
            </div>
            <p class="message-content">${escapeHtml(message)}</p>
            <div class="message-footer">
                <span>${language === 'ar' ? 'Ù…Ø±Ø³Ù„Ø©' : 'EnvoyÃ©'}</span>
            </div>
        </div>
        <div class="message-actions">
            <button class="message-action-btn" aria-label="Options" data-message-id="${messageId}">
                <i class="fas fa-ellipsis-v"></i>
            </button>
            <div class="message-action-dropdown" id="dropdown-${messageId}">
                <ul>
                    <li><a href="#" class="copy-message"><i class="far fa-copy"></i> ${language === 'ar' ? 'Ù†Ø³Ø®' : 'Copier'}</a></li>
                    <li><a href="#" class="delete-message"><i class="far fa-trash-alt"></i> ${language === 'ar' ? 'Ø­Ø°Ù' : 'Supprimer'}</a></li>
                </ul>
            </div>
        </div>
    `;

    chatMessages.appendChild(messageElement);
    scrollToBottom();

    // Remove animation class after animation completes
    setTimeout(() => {
        messageElement.classList.remove('animate-message-in-right');
    }, 500);

    // Update action buttons
    setupMessageActions();
}

/**
 * Add a bot message to the chat
 * @param {string} message - The message text
 * @param {string} messageId - Unique ID for the message
 * @param {string} language - Language of the message (fr or ar)
 */
function addBotMessage(message, messageId, language) {
    const chatMessages = document.getElementById('chat-messages');

    if (!chatMessages) return;

    // If language isn't specified, detect it from the message
    if (!language) {
        language = /[\u0600-\u06FF]/.test(message) ? 'ar' : 'fr';
    }

    const botAvatarSrc = 'https://ui-avatars.com/api/?name=ESPRIT&background=E12D2D&color=fff&size=128';

    const messageElement = document.createElement('div');
    messageElement.className = 'message bot animate-message-in-left';
    messageElement.setAttribute('data-language', language);

    // Check if in online mode to show indicator
    const modeIndicator = window.isOnlineMode ?
        `<span class="online-indicator" title="Mode en ligne"><i class="fas fa-wifi"></i></span>` : '';

    messageElement.innerHTML = `
        <div class="message-avatar">
            <img src="${botAvatarSrc}" alt="Bot Avatar">
        </div>
        <div class="message-container ${language === 'ar' ? 'rtl-text' : ''}">
            <div class="message-header">
                <span class="message-sender">ESPRIT Assistant ${modeIndicator}</span>
                <span class="message-time">${formatTime(new Date())}</span>
            </div>
            <p class="message-content">${escapeHtml(message)}</p>
            <div class="message-footer">
                <span>${language === 'ar' ? 'Ù…Ø±Ø³Ù„Ø©' : 'EnvoyÃ©'}</span>
            </div>
        </div>
        <div class="message-actions">
            <button class="message-action-btn" aria-label="Options" data-message-id="${messageId}">
                <i class="fas fa-ellipsis-v"></i>
            </button>
            <div class="message-action-dropdown" id="dropdown-${messageId}">
                <ul>
                    <li><a href="#" class="copy-message"><i class="far fa-copy"></i> ${language === 'ar' ? 'Ù†Ø³Ø®' : 'Copier'}</a></li>
                </ul>
            </div>
        </div>
    `;

    chatMessages.appendChild(messageElement);
    scrollToBottom();

    // Remove animation class after animation completes
    setTimeout(() => {
        messageElement.classList.remove('animate-message-in-left');
    }, 500);

    // Update action buttons
    setupMessageActions();
}

/**
 * Show typing indicator in the chat with animation
 */
function showTypingIndicator() {
    const chatMessages = document.getElementById('chat-messages');

    if (!chatMessages) return;

    // Remove any existing typing indicator
    hideTypingIndicator();

    const botAvatarSrc = 'https://ui-avatars.com/api/?name=ESPRIT&background=E12D2D&color=fff&size=128';

    // Create a new typing indicator
    const indicator = document.createElement('div');
    indicator.className = 'typing-indicator animate-fade-in';
    indicator.id = 'typing-indicator';

    // Add WiFi icon for online mode
    const onlineIndicator = window.isOnlineMode ?
        `<span class="online-typing-indicator"><i class="fas fa-wifi"></i></span>` : '';

    indicator.innerHTML = `
        <div class="message-avatar">
            <img src="${botAvatarSrc}" alt="Bot Avatar">
        </div>
        <div class="typing-indicator-container">
            ${onlineIndicator}
            <div class="typing-indicator-bubbles">
                <div class="typing-indicator-dot"></div>
                <div class="typing-indicator-dot"></div>
                <div class="typing-indicator-dot"></div>
            </div>
        </div>
    `;

    chatMessages.appendChild(indicator);
    scrollToBottom();
}

/**
 * Hide the typing indicator with animation
 */
function hideTypingIndicator() {
    const indicator = document.getElementById('typing-indicator');
    if (indicator) {
        indicator.classList.add('animate-fade-out');
        setTimeout(() => {
            if (indicator.parentNode) {
                indicator.parentNode.removeChild(indicator);
            }
        }, 300);
    }
}

/**
 * Update suggestions based on conversation
 * @param {string} lastMessage - The last message sent by user
 * @param {string} language - Language of the message
 */
function updateSuggestions(lastMessage, language) {
    const suggestionsContainer = document.getElementById('suggestions-container');
    const mobileSuggestions = document.getElementById('suggestions-container-mobile');

    if (!suggestionsContainer) return;

    // Default to French if no language specified
    if (!language) {
        language = /[\u0600-\u06FF]/.test(lastMessage) ? 'ar' : 'fr';
    }

    // Different suggestion sets based on conversation context and language
    let newSuggestions = [];

    lastMessage = lastMessage.toLowerCase();

    if (language === 'ar') {
        // Arabic suggestions based on context
        if (lastMessage.includes('Ù‚Ø§Ù„Ø¨') || lastMessage.includes('Ù†Ù…ÙˆØ°Ø¬') || lastMessage.includes('ØªØµÙ…ÙŠÙ…')) {
            newSuggestions = [
                { icon: 'fas fa-palette', text: 'ÙƒÙŠÙØ§Ø´ Ù†Ø®ØªØ§Ø± Ù‚Ø§Ù„Ø¨ Ù…Ù†Ø§Ø³Ø¨ØŸ', lang: 'ar' },
                { icon: 'fas fa-star', text: 'Ø£ÙØ¶Ù„ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ù‡Ù†ÙŠØ©ØŸ', lang: 'ar' },
                { icon: 'fas fa-file-alt', text: 'Ø§Ù†Ø´Ø§Ø¡ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©', lang: 'ar' },
                { icon: 'fas fa-question-circle', text: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©', lang: 'ar' }
            ];
        } else if (lastMessage.includes('Ø³ÙŠØ±Ø©') || lastMessage.includes('cv') || lastMessage.includes('Ù†Ø¹Ù…Ù„')) {
            newSuggestions = [
                { icon: 'fas fa-edit', text: 'ÙƒÙŠÙØ§Ø´ Ù†Ø­Ø±Ø± Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©ØŸ', lang: 'ar' },
                { icon: 'fas fa-download', text: 'ÙƒÙŠÙØ§Ø´ Ù†Ø­Ù…Ù„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©ØŸ', lang: 'ar' },
                { icon: 'fas fa-language', text: 'ÙƒÙŠÙØ§Ø´ Ù†ÙƒØªØ¨ Ø§Ù„Ø³ÙŠØ±Ø© Ø¨Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©ØŸ', lang: 'ar' },
                { icon: 'fas fa-question-circle', text: 'Ù…Ø³Ø§Ø¹Ø¯Ø© Ø­ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…', lang: 'ar' }
            ];
        } else if (lastMessage.includes('ØªØ­Ù…ÙŠÙ„') || lastMessage.includes('pdf') || lastMessage.includes('Ù†Ø²Ù„')) {
            newSuggestions = [
                { icon: 'fas fa-file-pdf', text: 'ØµÙŠØº Ù…ØªØ§Ø­Ø© Ù„Ù„ØªØ­Ù…ÙŠÙ„ØŸ', lang: 'ar' },
                { icon: 'fas fa-print', text: 'Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©ØŸ', lang: 'ar' },
                { icon: 'fas fa-envelope', text: 'Ø§Ø±Ø³Ø§Ù„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØŸ', lang: 'ar' },
                { icon: 'fas fa-share-alt', text: 'ÙƒÙŠÙØ§Ø´ Ù†Ø´Ø§Ø±Ùƒ Ø§Ù„Ø³ÙŠØ±Ø©ØŸ', lang: 'ar' }
            ];
        } else if (lastMessage.includes('Ø¨Ù„Ø§Ø´') || lastMessage.includes('ÙÙ„ÙˆØ³') || lastMessage.includes('Ø³Ø¹Ø±')) {
            newSuggestions = [
                { icon: 'fas fa-crown', text: 'Ø®Ø¯Ù…Ø§Øª Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…ØŸ', lang: 'ar' },
                { icon: 'fas fa-tag', text: 'Ø±Ù…ÙˆØ² Ø§Ù„Ø®ØµÙ…ØŸ', lang: 'ar' },
                { icon: 'fas fa-users', text: 'Ø¹Ø±ÙˆØ¶ Ù„Ù„Ø·Ù„Ø¨Ø©ØŸ', lang: 'ar' },
                { icon: 'fas fa-money-bill', text: 'Ø´Ù†ÙˆØ§ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù„ÙŠ Ø¨Ù„Ø§Ø´ØŸ', lang: 'ar' }
            ];
        } else if (lastMessage.includes('Ø´ÙƒØ±Ø§') || lastMessage.includes('Ù…Ø±Ø³ÙŠ') || lastMessage.includes('Ù…Ø³Ø§Ø¹Ø¯Ø©')) {
            newSuggestions = [
                { icon: 'fas fa-question-circle', text: 'Ø£Ø³Ø¦Ù„Ø© Ø£Ø®Ø±Ù‰ØŸ', lang: 'ar' },
                { icon: 'fas fa-file-alt', text: 'Ø§Ù†Ø´Ø§Ø¡ Ø³ÙŠØ±ØªÙŠ Ø§Ù„Ø°Ø§ØªÙŠØ©', lang: 'ar' },
                { icon: 'fas fa-star', text: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø©', lang: 'ar' },
                { icon: 'fas fa-hands-helping', text: 'ÙƒÙŠÙØ§Ø´ ØªØªØµÙ„ Ø¨Ø§Ù„Ø¯Ø¹Ù…ØŸ', lang: 'ar' }
            ];
        } else if (lastMessage.includes('Ù…Ù†Ø³ØªÙŠØ±') || lastMessage.includes('ØªÙˆÙ†Ø³') || lastMessage.includes('ØµÙØ§Ù‚Ø³') || lastMessage.includes('Ø³ÙˆØ³Ø©')) {
            newSuggestions = [
                { icon: 'fas fa-university', text: 'Ø´Ù†ÙˆØ© Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª ÙÙŠ ØªÙˆÙ†Ø³ØŸ', lang: 'ar' },
                { icon: 'fas fa-briefcase', text: 'ÙØ±Øµ Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŸ', lang: 'ar' },
                { icon: 'fas fa-graduation-cap', text: 'Ø´Ù‡Ø§Ø¯Ø§Øª Ù…Ø·Ù„ÙˆØ¨Ø©ØŸ', lang: 'ar' },
                { icon: 'fas fa-building', text: 'Ø´Ø±ÙƒØ§Øª Ø§Ù„ØªÙˆØ¸ÙŠÙØŸ', lang: 'ar' }
            ];
        } else if (lastMessage.includes('Ø®Ø¯Ù…Ø©') || lastMessage.includes('Ø´ØºÙ„') || lastMessage.includes('Ø¹Ù…Ù„') || lastMessage.includes('ØªÙˆØ¸ÙŠÙ')) {
            newSuggestions = [
                { icon: 'fas fa-search', text: 'ÙˆÙŠÙ† Ù†Ù„Ù‚Ù‰ Ø®Ø¯Ù…Ø© ÙÙŠ ØªÙˆÙ†Ø³ØŸ', lang: 'ar' },
                { icon: 'fas fa-briefcase', text: 'Ø´Ù†ÙŠØ© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©ØŸ', lang: 'ar' },
                { icon: 'fas fa-handshake', text: 'ÙƒÙŠÙØ§Ø´ Ù†Ø³ØªØ¹Ø¯ Ù„Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©ØŸ', lang: 'ar' },
                { icon: 'fas fa-chart-line', text: 'Ù…Ø¬Ø§Ù„Ø§Øª Ù…Ø·Ù„ÙˆØ¨Ø© Ø­Ø§Ù„ÙŠØ§ØŸ', lang: 'ar' }
            ];
        } else {
            // Default Arabic suggestions
            newSuggestions = [
                { icon: 'fas fa-file-alt', text: 'ÙƒÙŠÙØ§Ø´ Ù†Ø¹Ù…Ù„ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©ØŸ', lang: 'ar' },
                { icon: 'fas fa-briefcase', text: 'ÙƒÙŠÙØ§Ø´ Ù†Ù„Ù‚Ù‰ Ø®Ø¯Ù…Ø©ØŸ', lang: 'ar' },
                { icon: 'fas fa-palette', text: 'Ø´Ù†ÙŠØ© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…ØªÙˆÙØ±Ø©ØŸ', lang: 'ar' },
                { icon: 'fas fa-star', text: 'Ø´Ù†ÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ', lang: 'ar' }
            ];
        }
    } else {
        // French suggestions based on context
        if (lastMessage.includes('template') || lastMessage.includes('modÃ¨le') || lastMessage.includes('design')) {
            newSuggestions = [
                { icon: 'fas fa-palette', text: 'Comment choisir un template?', lang: 'fr' },
                { icon: 'fas fa-star', text: 'Templates populaires?', lang: 'fr' },
                { icon: 'fas fa-file-alt', text: 'CrÃ©er un CV', lang: 'fr' },
                { icon: 'fas fa-question-circle', text: 'Plus d\'informations', lang: 'fr' }
            ];
        } else if (lastMessage.includes('cv') || lastMessage.includes('crÃ©er') || lastMessage.includes('creer') || lastMessage.includes('curriculum')) {
            newSuggestions = [
                { icon: 'fas fa-edit', text: 'Comment Ã©diter mon CV?', lang: 'fr' },
                { icon: 'fas fa-download', text: 'Comment tÃ©lÃ©charger mon CV?', lang: 'fr' },
                { icon: 'fas fa-language', text: 'CV en plusieurs langues?', lang: 'fr' },
                { icon: 'fas fa-question-circle', text: 'Aide sur les sections', lang: 'fr' }
            ];
        } else if (lastMessage.includes('tÃ©lÃ©charger') || lastMessage.includes('telecharger') || lastMessage.includes('pdf') || lastMessage.includes('export')) {
            newSuggestions = [
                { icon: 'fas fa-file-pdf', text: 'Formats disponibles?', lang: 'fr' },
                { icon: 'fas fa-print', text: 'Options d\'impression?', lang: 'fr' },
                { icon: 'fas fa-envelope', text: 'Envoyer par email?', lang: 'fr' },
                { icon: 'fas fa-share-alt', text: 'Comment partager mon CV?', lang: 'fr' }
            ];
        } else if (lastMessage.includes('gratuit') || lastMessage.includes('prix') || lastMessage.includes('coÃ»t') || lastMessage.includes('payer')) {
            newSuggestions = [
                { icon: 'fas fa-crown', text: 'FonctionnalitÃ©s premium?', lang: 'fr' },
                { icon: 'fas fa-tag', text: 'Codes promotionnels?', lang: 'fr' },
                { icon: 'fas fa-users', text: 'Offres Ã©tudiantes?', lang: 'fr' },
                { icon: 'fas fa-money-bill', text: 'Services gratuits?', lang: 'fr' }
            ];
        } else if (lastMessage.includes('merci') || lastMessage.includes('aide') || lastMessage.includes('support') || lastMessage.includes('assistance')) {
            newSuggestions = [
                { icon: 'fas fa-question-circle', text: 'Autres questions?', lang: 'fr' },
                { icon: 'fas fa-file-alt', text: 'CrÃ©er mon CV', lang: 'fr' },
                { icon: 'fas fa-star', text: 'Noter le service', lang: 'fr' },
                { icon: 'fas fa-hands-helping', text: 'Contacter le support?', lang: 'fr' }
            ];
        } else if (lastMessage.includes('monastir') || lastMessage.includes('tunis') || lastMessage.includes('sfax') || lastMessage.includes('sousse')) {
            newSuggestions = [
                { icon: 'fas fa-university', text: 'UniversitÃ©s en Tunisie?', lang: 'fr' },
                { icon: 'fas fa-briefcase', text: 'OpportunitÃ©s d\'emploi?', lang: 'fr' },
                { icon: 'fas fa-graduation-cap', text: 'DiplÃ´mes recherchÃ©s?', lang: 'fr' },
                { icon: 'fas fa-building', text: 'Entreprises qui recrutent?', lang: 'fr' }
            ];
        } else if (lastMessage.includes('emploi') || lastMessage.includes('travail') || lastMessage.includes('job') || lastMessage.includes('recrutement')) {
            newSuggestions = [
                { icon: 'fas fa-search', text: 'OÃ¹ chercher un emploi?', lang: 'fr' },
                { icon: 'fas fa-briefcase', text: 'Documents nÃ©cessaires?', lang: 'fr' },
                { icon: 'fas fa-handshake', text: 'PrÃ©parer un entretien?', lang: 'fr' },
                { icon: 'fas fa-chart-line', text: 'Secteurs qui recrutent?', lang: 'fr' }
            ];
        } else {
            // Default French suggestions
            newSuggestions = [
                { icon: 'fas fa-file-alt', text: 'Comment crÃ©er un CV?', lang: 'fr' },
                { icon: 'fas fa-briefcase', text: 'Comment trouver un emploi?', lang: 'fr' },
                { icon: 'fas fa-palette', text: 'Templates disponibles?', lang: 'fr' },
                { icon: 'fas fa-star', text: 'CompÃ©tences importantes?', lang: 'fr' }
            ];
        }
    }

    // Update desktop suggestions with animation
    updateSuggestionButtons(suggestionsContainer, newSuggestions);

    // Update mobile suggestions if they exist
    if (mobileSuggestions) {
        updateSuggestionButtons(mobileSuggestions, newSuggestions);
    }
}

/**
 * Update the suggestion buttons in a container with animation
 * @param {HTMLElement} container - The suggestions container
 * @param {Array} suggestions - Array of suggestion objects with icon and text
 */
function updateSuggestionButtons(container, suggestions) {
    // Keep the suggestion title element
    const title = container.querySelector('.suggestion-title');

    // Apply fade-out animation to current buttons
    const currentButtons = container.querySelectorAll('.suggestion-button');
    currentButtons.forEach(button => {
        button.classList.add('animate-fade-out-fast');
    });

    // After animation, clear and add new buttons
    setTimeout(() => {
        // Clear existing buttons
        container.innerHTML = '';

        // Add the title back
        container.appendChild(title);

        // Add new suggestion buttons with animation
        suggestions.forEach((suggestion, index) => {
            const button = document.createElement('button');
            button.className = 'suggestion-button animate-pop-staggered';
            button.style.animationDelay = `${index * 0.1}s`;
            button.setAttribute('data-message', suggestion.text);
            if (suggestion.lang) {
                button.setAttribute('data-lang', suggestion.lang);
            }

            // Add RTL class for Arabic suggestions
            if (suggestion.lang === 'ar') {
                button.classList.add('rtl-text');
            }

            button.innerHTML = `<i class="${suggestion.icon}"></i> ${suggestion.text}`;

            button.addEventListener('click', function() {
                const message = this.getAttribute('data-message');
                const lang = this.getAttribute('data-lang');
                if (message) {
                    // Set the message in the input
                    const chatInput = document.getElementById('chat-input');
                    if (chatInput) {
                        chatInput.value = message;

                        // Set the preferred language based on the suggestion language
                        if (lang) {
                            window.preferredLanguage = lang;
                        }

                        sendMessage();
                    }
                }
            });

            container.appendChild(button);

            // Remove animation class after animation completes
            setTimeout(() => {
                button.classList.remove('animate-pop-staggered');
            }, 500);
        });
    }, 200);
}

/**
 * Display a toast notification with animation
 * @param {string} message - Message to display
 */
function showToast(message) {
    // Check if a toast container already exists, if not create one
    let toastContainer = document.getElementById('toast-container');

    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.style.position = 'fixed';
        toastContainer.style.bottom = '20px';
        toastContainer.style.left = '20px';
        toastContainer.style.zIndex = '10000';
        document.body.appendChild(toastContainer);
    }

    // Create toast element
    const toast = document.createElement('div');
    toast.className = 'toast animate-toast-in';
    toast.textContent = message;

    // Add to container
    toastContainer.appendChild(toast);

    // Remove after delay
    setTimeout(() => {
        toast.classList.add('animate-toast-out');

        // Remove from DOM after animation
        setTimeout(() => {
            if (toastContainer.contains(toast)) {
                toastContainer.removeChild(toast);
            }

            // Remove container if empty
            if (toastContainer.childElementCount === 0) {
                document.body.removeChild(toastContainer);
            }
        }, 300);
    }, 2000);
}

/**
 * Get a response from the bot based on user input
 * @param {string} message - The user's message
 * @param {string} language - The language of the message (fr or ar)
 * @returns {string} - The bot's response
 */
function getBotResponse(message, language) {
    message = message.toLowerCase();

    // If no language is specified, detect it from the message
    if (!language) {
        language = /[\u0600-\u06FF]/.test(message) ? 'ar' : 'fr';
    }

    // Responses in French
    if (language === 'fr') {
        // CV creation
        if ((message.includes('cv') || message.includes('curriculum') || message.includes('resume')) &&
            (message.includes('creer') || message.includes('crÃ©er') || message.includes('faire'))) {
            return 'Pour crÃ©er un CV, cliquez sur le bouton "CrÃ©er mon CV" en haut de la page. Vous pourrez ensuite choisir un template et remplir vos informations personnelles, votre expÃ©rience professionnelle et votre formation.';
        }

        // CV templates
        if (message.includes('template') || message.includes('modÃ¨le') || message.includes('modele')) {
            return 'Nous proposons 15 templates professionnels diffÃ©rents, adaptÃ©s Ã  divers secteurs d\'activitÃ©. Vous pouvez les consulter dans la section "Templates". Chaque template peut Ãªtre personnalisÃ© selon vos prÃ©fÃ©rences en termes de couleurs, polices et mise en page.';
        }

        // Downloading/exporting CV
        if (message.includes('tÃ©lÃ©charger') || message.includes('telecharger') || message.includes('exporter') ||
            message.includes('pdf')) {
            return 'Une fois votre CV complÃ©tÃ©, vous pourrez l\'exporter en format PDF haute qualitÃ© en cliquant sur le bouton "TÃ©lÃ©charger" dans votre espace personnel. Nous proposons Ã©galement d\'autres formats comme Word ou JPG selon vos besoins.';
        }

        // Pricing information
        if (message.includes('gratuit') || message.includes('prix') || message.includes('coÃ»te') ||
            message.includes('coute')) {
            return 'Notre service de base pour la crÃ©ation de CV est gratuit pour les Ã©tudiants d\'ESPRIT. Des options premium sont Ã©galement disponibles, comme des templates exclusifs, l\'analyse avancÃ©e de CV et le suivi de candidatures, Ã  partir de 5 dinars par mois.';
        }

        // How to find a job
        if (message.includes('emploi') || message.includes('job') || message.includes('travail') ||
            message.includes('chercher') || message.includes('trouver')) {
            return 'Pour trouver un emploi en Tunisie, nous vous recommandons d\'utiliser des plateformes comme Tanitjobs, Keejob, Emploi.tn et LinkedIn. Suivez Ã©galement les pages des entreprises qui vous intÃ©ressent et participez aux journÃ©es portes ouvertes et salons de recrutement. Un CV professionnel crÃ©Ã© sur notre plateforme augmentera considÃ©rablement vos chances!';
        }

        // Interview tips
        if (message.includes('entretien') || message.includes('interview')) {
            return 'Pour rÃ©ussir un entretien d\'embauche: renseignez-vous sur l\'entreprise avant l\'entretien, prÃ©parez-vous aux questions courantes, habillez-vous professionnellement, prÃ©parez des exemples concrets de vos rÃ©alisations, montrez votre enthousiasme pour le poste et posez des questions pertinentes Ã  la fin. N\'oubliez pas d\'apporter une copie imprimÃ©e de votre CV!';
        }

        // Important skills
        if (message.includes('compÃ©tence') || message.includes('competence') || message.includes('skill')) {
            return 'Les compÃ©tences importantes Ã  mentionner dans votre CV comprennent: compÃ©tences techniques spÃ©cifiques Ã  votre domaine, langues Ã©trangÃ¨res, communication, travail d\'Ã©quipe, rÃ©solution de problÃ¨mes et gestion de projet. Classez vos compÃ©tences par catÃ©gorie et indiquez votre niveau de maÃ®trise. Pour les mÃ©tiers techniques, prÃ©cisez les logiciels et technologies que vous maÃ®trisez.';
        }

        // Education institutions
        if ((message.includes('education') || message.includes('formation') || message.includes('Ã©tude') || message.includes('etude')) &&
            (message.includes('esprit'))) {
            return 'Si vous Ãªtes diplÃ´mÃ© d\'ESPRIT (Ã‰cole SupÃ©rieure PrivÃ©e d\'IngÃ©nierie et de Technologies), c\'est excellent Ã  mentionner dans votre CV! ESPRIT est connue pour sa formation de haute qualitÃ© en ingÃ©nierie et technologie. PrÃ©cisez votre spÃ©cialisation (gÃ©nie logiciel, rÃ©seaux, intelligence artificielle...), l\'annÃ©e d\'obtention de votre diplÃ´me et les projets importants auxquels vous avez participÃ©. Les diplÃ´mÃ©s d\'ESPRIT sont recherchÃ©s sur le marchÃ© du travail.';
        }

        // General greeting
        if (message.includes('bonjour') || message.includes('salut') || message.includes('hello')) {
            return 'Bonjour! Comment puis-je vous aider avec la crÃ©ation de votre CV ou votre recherche d\'emploi aujourd\'hui?';
        }

        // Default French response
        return 'Je ne suis pas sÃ»r de comprendre votre question. Je peux vous aider avec la crÃ©ation de votre CV, vous donner des conseils sur votre carriÃ¨re ou rÃ©pondre Ã  des questions gÃ©nÃ©rales sur l\'emploi et l\'Ã©ducation. N\'hÃ©sitez pas Ã  reformuler votre question.';
    }
    // Responses in Arabic
    else {
        // CV creation
        if ((message.includes('cv') || message.includes('Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©')) &&
            (message.includes('Ù†Ø¹Ù…Ù„') || message.includes('Ù†Ø®Ø¯Ù…'))) {
            return 'Ø¨Ø§Ø´ ØªØ¹Ù…Ù„ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©ØŒ Ø£Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "CrÃ©er mon CV" Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©. ØªÙ†Ø¬Ù… Ø¨Ø¹Ø¯Ù‡Ø§ ØªØ®ØªØ§Ø± Ù‚Ø§Ù„Ø¨ Ùˆ ØªØ¹Ø¨Ù‘ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© Ùˆ Ø®Ø¨Ø±Ø§ØªÙƒ Ø§Ù„Ù…Ù‡Ù†ÙŠØ© Ùˆ ØªØ¹Ù„ÙŠÙ…Ùƒ.';
        }

        // CV templates
        if (message.includes('Ù‚Ø§Ù„Ø¨') || message.includes('ØªØµÙ…ÙŠÙ…') || message.includes('Ù†Ù…ÙˆØ°Ø¬')) {
            return 'Ù†ÙˆÙØ±Ùˆ 15 Ù‚Ø§Ù„Ø¨ Ù…Ø­ØªØ±Ù Ù…Ø®ØªÙ„ÙØŒ Ù…Ù†Ø§Ø³Ø¨ÙŠÙ† Ù„Ù…Ø¬Ø§Ù„Ø§Øª Ù…Ø®ØªÙ„ÙØ©. ØªÙ†Ø¬Ù… ØªØ´ÙˆÙÙ‡Ù… ÙÙŠ Ù‚Ø³Ù… "Templates". ÙƒÙ„ Ù‚Ø§Ù„Ø¨ ÙŠÙ…ÙƒÙ† ØªØ®ØµÙŠØµÙ‡ Ø­Ø³Ø¨ ØªÙØ¶ÙŠÙ„Ø§ØªÙƒ Ù…Ù† Ù†Ø§Ø­ÙŠØ© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ùˆ Ø§Ù„Ø®Ø·ÙˆØ· Ùˆ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚.';
        }

        // Downloading/exporting CV
        if (message.includes('ØªØ­Ù…ÙŠÙ„') || message.includes('pdf') || message.includes('Ù†Ø²Ù„')) {
            return 'Ø¨Ø¹Ø¯ Ù…Ø§ ØªÙƒÙ…Ù„ Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ©ØŒ ØªÙ†Ø¬Ù… ØªØ­Ù…Ù„Ù‡Ø§ Ø¨ØµÙŠØºØ© PDF Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø© Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "TÃ©lÃ©charger" ÙÙŠ ØµÙØ­ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©. ÙƒÙ…Ø§ Ù†ÙˆÙØ± ØµÙŠØº Ø£Ø®Ø±Ù‰ Ù…Ø«Ù„ Word Ø£Ùˆ JPG Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ.';
        }

        // Pricing information
        if (message.includes('Ø¨Ù„Ø§Ø´') || message.includes('ÙÙ„ÙˆØ³') || message.includes('Ø³Ø¹Ø±')) {
            return 'Ø®Ø¯Ù…ØªÙ†Ø§ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ù„Ø§Ø´ Ù„Ø·Ù„Ø¨Ø© ESPRIT. ØªÙˆØ¬Ø¯ Ø®Ø¯Ù…Ø§Øª Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… ÙƒÙŠÙ…Ø§ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø®Ø§ØµØ©ØŒ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ±Ø´Ø­Ø§ØªØŒ Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† 5 Ø¯Ù†Ø§Ù†ÙŠØ± ÙÙŠ Ø§Ù„Ø´Ù‡Ø±.';
        }

        // How to find a job
        if (message.includes('Ø®Ø¯Ù…Ø©') || message.includes('Ø´ØºÙ„') || message.includes('ÙˆØ¸ÙŠÙØ©') ||
            message.includes('Ù†Ù„Ù‚Ù‰')) {
            return 'Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† ÙØ±Øµ Ø¹Ù…Ù„ ÙÙŠ ØªÙˆÙ†Ø³ØŒ ØªÙ†Ø¬Ù… ØªØ³ØªØ¹Ù…Ù„ Ù…ÙˆØ§Ù‚Ø¹ Ù…Ø«Ù„ Tanitjobs, Keejob, Emploi.tn Ùˆ LinkedIn. Ø²ÙŠØ¯ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ØŒ ØªØ§Ø¨Ø¹ ØµÙØ­Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ù„ÙŠ ØªÙ‡Ù…Ùƒ Ø¹Ù„Ù‰ Facebook Ùˆ LinkedIn Ùˆ Ø§Ø­Ø¶Ø± Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ù…ÙØªÙˆØ­Ø© Ùˆ Ù…Ø¹Ø§Ø±Ø¶ Ø§Ù„ØªÙˆØ¸ÙŠÙ. Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ© Ù…Ø­ØªØ±ÙØ© Ù…Ù† Ù…ÙˆÙ‚Ø¹Ù†Ø§ ØªØ²ÙŠØ¯ Ù…Ù† ÙØ±ØµÙƒ Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ±!';
        }

        // Interview tips
        if (message.includes('Ù…Ù‚Ø§Ø¨Ù„Ø©') || message.includes('Ø§Ù†ØªØ±ÙÙŠÙˆ')) {
            return 'Ø¨Ø§Ø´ ØªÙ†Ø¬Ø­ ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©: Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø´Ø±ÙƒØ© Ù‚Ø¨Ù„ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©ØŒ Ø§ØªÙ…Ø±Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©ØŒ Ø§Ù„Ø¨Ø³ Ù„Ø¨Ø§Ø³ Ù…Ø­ØªØ±Ù…ØŒ Ø£Ø­Ø¶Ø± Ø£Ù…Ø«Ù„Ø© Ø¹Ù† Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒØŒ Ø£Ø¸Ù‡Ø± Ø­Ù…Ø§Ø³Ùƒ Ù„Ù„ÙˆØ¸ÙŠÙØ©ØŒ Ùˆ Ø§Ø·Ø±Ø­ Ø£Ø³Ø¦Ù„Ø© Ø°ÙƒÙŠØ© ÙÙŠ Ø§Ù„Ø¢Ø®Ø±. Ù…ØªÙ†Ø³Ø§Ø´ ØªØ¬ÙŠØ¨ Ù†Ø³Ø®Ø© Ù…Ø·Ø¨ÙˆØ¹Ø© Ù…Ù† Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ© Ù…Ù† Ù…ÙˆÙ‚Ø¹Ù†Ø§!';
        }

        // Important skills
        if (message.includes('Ù…Ù‡Ø§Ø±Ø§Øª') || message.includes('ÙƒÙØ§Ø¡Ø§Øª')) {
            return 'Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù„ÙŠ Ù„Ø§Ø²Ù… ØªØ°ÙƒØ±Ù‡Ø§ ÙÙŠ Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ© ØªØ´Ù…Ù„: Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù…Ø¬Ø§Ù„ÙƒØŒ Ø§Ù„Ù„ØºØ§Øª Ø§Ù„Ø£Ø¬Ù†Ø¨ÙŠØ©ØŒ Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ØŒ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØŒ Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ØŒ Ùˆ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹. Ù‚Ø³Ù‘Ù… Ù…Ù‡Ø§Ø±Ø§ØªÙƒ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ Ùˆ Ø£ÙƒØªØ¨ Ù…Ø³ØªÙˆÙ‰ Ø¥ØªÙ‚Ø§Ù†Ùƒ ÙÙŠÙ‡Ø§. Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„Ù…Ù‡Ù† Ø§Ù„ØªÙ‚Ù†ÙŠØ©ØŒ Ø­Ø¯Ø¯ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ùˆ Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù„ÙŠ ØªØªÙ‚Ù†Ù‡Ø§.';
        }

        // Education institutions
        if ((message.includes('Ù‚Ø±ÙŠØª') || message.includes('Ø¯Ø±Ø³Øª') || message.includes('ØªØ¹Ù„ÙŠÙ…')) &&
            (message.includes('esprit'))) {
            return 'Ø¥Ø°Ø§ ÙƒÙ†Øª Ø®Ø±ÙŠØ¬ ESPRIT (Ã‰cole SupÃ©rieure PrivÃ©e d\'IngÃ©nierie et de Technologies)ØŒ Ù‡Ø°Ø§ Ø£Ù…Ø± Ù…Ù…ØªØ§Ø² Ù„Ù„Ø°ÙƒØ± ÙÙŠ Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ©! ESPRIT Ù…Ø¹Ø±ÙˆÙØ© Ø¨ØªÙƒÙˆÙŠÙ†Ù‡Ø§ Ø§Ù„Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§. Ø§Ø°ÙƒØ± Ø§Ù„ØªØ®ØµØµ Ø¨Ø§Ù„ØªÙØµÙŠÙ„ (Ù‡Ù†Ø¯Ø³Ø© Ø¨Ø±Ù…Ø¬ÙŠØ§ØªØŒ Ø´Ø¨ÙƒØ§ØªØŒ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...)ØŒ Ø³Ù†Ø© Ø§Ù„ØªØ®Ø±Ø¬ØŒ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„ØªÙŠ Ø´Ø§Ø±ÙƒØª ÙÙŠÙ‡Ø§. Ø®Ø±ÙŠØ¬Ùˆ ESPRIT Ù…Ø·Ù„ÙˆØ¨ÙˆÙ† ÙÙŠ Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ù…Ù„.';
        }

        // General greeting
        if (message.includes('Ø¹Ø³Ù„Ø§Ù…Ø©') || message.includes('Ø³Ù„Ø§Ù…') || message.includes('Ù…Ø±Ø­Ø¨Ø§')) {
            return 'Ø¹Ø³Ù„Ø§Ù…Ø©! ÙƒÙŠÙØ§Ø´ Ù†Ø¬Ù… Ù†Ø¹Ø§ÙˆÙ†Ùƒ ÙÙŠ Ø¹Ù…Ù„ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ© Ù…Ù‡Ù†ÙŠØ© Ø£Ùˆ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙˆØ¸ÙŠÙØ© Ø§Ù„ÙŠÙˆÙ…ØŸ';
        }

        // Default Arabic response
        return 'Ù…Ø§Ù†ÙŠØ´ Ù…ØªØ£ÙƒØ¯ Ø£Ù†ÙŠ ÙÙ‡Ù…Øª Ø³Ø¤Ø§Ù„Ùƒ. Ù†Ø¬Ù… Ù†Ø¹Ø§ÙˆÙ†Ùƒ ÙÙŠ Ø¹Ù…Ù„ Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ©ØŒ Ù†Ø¹Ø·ÙŠÙƒ Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù‡Ù†ÙŠØŒ Ùˆ Ù†Ø¬Ø§ÙˆØ¨ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ø¹Ø§Ù…Ø© Ø­ÙˆÙ„ Ø§Ù„Ø´ØºÙ„ Ùˆ Ø§Ù„ØªØ¹Ù„ÙŠÙ…. Ø­Ø§ÙˆÙ„ ØªØ¹Ø§ÙˆØ¯ ØªØµÙˆØº Ø³Ø¤Ø§Ù„Ùƒ.';
    }
}

/**
 * Format time for display (HH:MM)
 * @param {Date} date - Date object
 * @returns {string} - Formatted time
 */
function formatTime(date) {
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    return `${hours}:${minutes}`;
}

/**
 * Scroll chat messages to the bottom
 */
function scrollToBottom() {
    const chatMessages = document.getElementById('chat-messages');
    if (chatMessages) {
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
}

/**
 * Escape HTML to prevent XSS
 * @param {string} text - Text to escape
 * @returns {string} - Escaped text
 */
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

/**
 * Check if device is mobile
 * @returns {boolean} - True if mobile device
 */
function isMobile() {
    return window.innerWidth <= 768;
}

// Initialize preferred language
window.preferredLanguage = 'mixed';

// Add window resize listener to adjust suggestions position
window.addEventListener('resize', adjustSuggestionsPosition);

// Add styles for RTL text and animations
const styleElement = document.createElement('style');
styleElement.textContent = `
    .rtl-text {
        direction: rtl;
        text-align: right;
    }
    
    /* Message animations */
    .animate-message-in-right {
        animation: slideInRight 0.4s ease forwards;
    }
    
    .animate-message-in-left {
        animation: slideInLeft 0.4s ease forwards;
    }
    
    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    @keyframes slideInLeft {
        from {
            opacity: 0;
            transform: translateX(-30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    /* Pop animations */
    .animate-pop {
        animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        transform-origin: center;
    }
    
    .animate-pop-staggered {
        animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        transform-origin: center;
        opacity: 0;
        transform: scale(0.8);
    }
    
    @keyframes popIn {
        from {
            opacity: 0;
            transform: scale(0.8);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
    
    /* Fade animations */
    .animate-fade-in {
        animation: fadeIn 0.3s ease forwards;
    }
    
    .animate-fade-out {
        animation: fadeOut 0.3s ease forwards;
    }
    
    .animate-fade-out-fast {
        animation: fadeOut 0.2s ease forwards;
    }
    
    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    
    @keyframes fadeOut {
        from {
            opacity: 1;
        }
        to {
            opacity: 0;
        }
    }
    
    /* Slide animations */
    .animate-slide-in {
        animation: slideIn 0.3s ease forwards;
    }
    
    .animate-slide-out {
        animation: slideOut 0.3s ease forwards;
    }
    
    .animate-slide-in-up {
        animation: slideInUp 0.4s cubic-bezier(0.215, 0.610, 0.355, 1.000) forwards;
    }
    
    .animate-slide-out-down {
        animation: slideOutDown 0.4s cubic-bezier(0.215, 0.610, 0.355, 1.000) forwards;
    }
    
    @keyframes slideIn {
        from {
            transform: translateX(-20px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(20px);
            opacity: 0;
        }
    }
    
    @keyframes slideInUp {
        from {
            transform: translateY(30px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOutDown {
        from {
            transform: translateY(0);
            opacity: 1;
        }
        to {
            transform: translateY(30px);
            opacity: 0;
        }
    }
    
    /* Scale animations */
    .animate-scale-in {
        animation: scaleIn 0.3s ease forwards;
        transform-origin: bottom left;
    }
    
    .animate-scale-out {
        animation: scaleOut 0.3s ease forwards;
        transform-origin: bottom left;
    }
    
    @keyframes scaleIn {
        from {
            transform: scale(0);
            opacity: 0;
        }
        to {
            transform: scale(1);
            opacity: 1;
        }
    }
    
    @keyframes scaleOut {
        from {
            transform: scale(1);
            opacity: 1;
        }
        to {
            transform: scale(0);
            opacity: 0;
        }
    }
    
    /* Bounce animation */
    .animate-bounce {
        animation: bounce 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }
    
    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-10px);
        }
        60% {
            transform: translateY(-5px);
        }
    }
    
    /* Toast animation */
    .toast {
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px 15px;
        border-radius: 4px;
        margin-top: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    .animate-toast-in {
        animation: toastIn 0.3s ease forwards;
    }
    
    .animate-toast-out {
        animation: toastOut 0.3s ease forwards;
    }
    
    @keyframes toastIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes toastOut {
        from {
            opacity: 1;
            transform: translateY(0);
        }
        to {
            opacity: 0;
            transform: translateY(-20px);
        }
    }
    
    /* Status change animation */
    .status-change {
        animation: flash 0.6s ease;
    }
    
    @keyframes flash {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.5;
            color: #4CAF50;
        }
    }
    
    /* Online/Offline toggle switch */
    .chat-mode-toggle {
        display: flex;
        align-items: center;
        margin: 0 20px;
    }
    
    .mode-label {
        font-size: 12px;
        margin: 0 5px;
    }
    
    .offline-label {
        color: #777;
    }
    
    .online-label {
        color: #4CAF50;
    }
    
    /* The switch - the box around the slider */
    .switch {
        position: relative;
        display: inline-block;
        width: 36px;
        height: 20px;
    }
    
    /* Hide default HTML checkbox */
    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    /* The slider */
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
    }
    
    .slider:before {
        position: absolute;
        content: "";
        height: 14px;
        width: 14px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .4s;
    }
    
    input:checked + .slider {
        background-color: #4CAF50;
    }
    
    input:focus + .slider {
        box-shadow: 0 0 1px #4CAF50;
    }
    
    input:checked + .slider:before {
        transform: translateX(16px);
    }
    
    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
    }
    
    .slider.round:before {
        border-radius: 50%;
    }
    
    /* Mode info styles */
    .mode-info {
        margin-top: 10px;
        padding: 10px;
        border-radius: 5px;
        background-color: #f8f9fa;
        display: flex;
        align-items: center;
    }
    
    .mode-info-icon {
        margin-right: 8px;
        color: #6c757d;
    }
    
    .mode-info-text {
        font-size: 12px;
        color: #6c757d;
    }
    
    /* Status message styles */
    .chat-status-message {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 10px auto;
        padding: 8px 15px;
        border-radius: 20px;
        background-color: #f8f9fa;
        max-width: 80%;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .status-icon {
        margin-right: 8px;
        font-size: 14px;
    }
    
    .status-icon.online {
        color: #4CAF50;
    }
    
    .status-icon.offline {
        color: #777;
    }
    
    .status-text {
        font-size: 12px;
        color: #555;
    }
    
    /* Online indicator in messages */
    .online-indicator {
        font-size: 12px;
        color: #4CAF50;
        margin-left: 5px;
    }
    
    .online-typing-indicator {
        font-size: 12px;
        color: #4CAF50;
        margin-right: 8px;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% {
            opacity: 0.5;
        }
        50% {
            opacity: 1;
        }
        100% {
            opacity: 0.5;
        }
    }
    
    /* Typing indicator bubbles */
    .typing-indicator-container {
        display: flex;
        align-items: center;
    }
    
    .typing-indicator {
        display: flex;
        align-items: center;
        padding: 10px;
        margin: 10px 0;
    }
    
    .typing-indicator-bubbles {
        display: flex;
        align-items: center;
        background-color: #f0f0f0;
        border-radius: 15px;
        padding: 10px 15px;
    }
    
    .typing-indicator-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #555;
        margin: 0 2px;
        display: inline-block;
        opacity: 0.6;
    }
    
    .typing-indicator-dot:nth-child(1) {
        animation: typingAnimation 1.5s infinite 0s;
    }
    
    .typing-indicator-dot:nth-child(2) {
        animation: typingAnimation 1.5s infinite 0.3s;
    }
    
    .typing-indicator-dot:nth-child(3) {
        animation: typingAnimation 1.5s infinite 0.6s;
    }
    
    @keyframes typingAnimation {
        0% {
            transform: translateY(0px);
            opacity: 0.6;
        }
        50% {
            transform: translateY(-5px);
            opacity: 1;
        }
        100% {
            transform: translateY(0px);
            opacity: 0.6;
        }
    }
    
    /* Attachment styles */
    .attachment-options {
        position: absolute;
        bottom: 80px;
        left: 20px;
        right: 20px;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 15px;
        z-index: 1000;
    }
    
    .attachment-header {
        font-weight: bold;
        margin-bottom: 10px;
        text-align: center;
    }
    
    .attachment-types {
        display: flex;
        justify-content: space-around;
        margin: 15px 0;
    }
    
    .attachment-type {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
        border: 1px solid #eee;
        border-radius: 8px;
        cursor: pointer;
        width: 30%;
        transition: all 0.3s ease;
    }
    
    .attachment-type:hover {
        background-color: #f9f9f9;
        border-color: #E12D2D;
        transform: scale(1.05);
    }
    
    .attachment-type i {
        font-size: 24px;
        margin-bottom: 8px;
        color: #E12D2D;
    }
    
    .attachment-footer {
        text-align: center;
    }
    
    .attachment-footer button {
        padding: 5px 15px;
        background-color: #f5f5f5;
        border: none;
        border-radius: 15px;
        cursor: pointer;
    }
    
    /* Upload styles */
    .upload-status {
        display: flex;
        align-items: center;
        background-color: #f9f9f9;
        border-radius: 8px;
        margin: 10px 20px;
        padding: 10px;
    }
    
    .upload-icon {
        margin-right: 10px;
        font-size: 20px;
        color: #E12D2D;
    }
    
    .upload-details {
        flex: 1;
    }
    
    .upload-filename {
        font-size: 14px;
        margin-bottom: 5px;
    }
    
    .upload-progress-container {
        height: 5px;
        background-color: #e0e0e0;
        border-radius: 3px;
        margin: 5px 0;
    }
    
    .upload-progress-bar {
        height: 100%;
        background-color: #E12D2D;
        border-radius: 3px;
        transition: width 0.3s ease;
    }
    
    .upload-percentage {
        font-size: 12px;
        color: #666;
    }
    
    .upload-actions {
        margin-left: 10px;
    }
    
    .upload-cancel {
        background: none;
        border: none;
        color: #999;
        cursor: pointer;
        font-size: 16px;
    }
    
    .upload-complete {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        color: #34a853;
    }
    
    .upload-complete i {
        margin-right: 10px;
    }
    
    /* Emoji picker */
    .emoji-picker {
        position: absolute;
        bottom: 60px;
        left: 10px;
        z-index: 1000;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 10px;
        width: 280px;
    }
    
    .emoji-container {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 10px;
    }
    
    .emoji {
        font-size: 20px;
        padding: 5px;
        cursor: pointer;
        transition: transform 0.2s;
    }
    
    .emoji:hover {
        transform: scale(1.5);
    }
    
    #close-emoji-picker {
        width: 100%;
        padding: 5px;
        background-color: #f5f5f5;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
`;

document.head.appendChild(styleElement);
